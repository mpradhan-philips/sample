# Input and initializing path variables
#[CmdletBinding()]
#param (
#    [Parameter(Mandatory = $true)][string]$repoPath,
#    [Parameter(Mandatory = $true)][string]$repoName,
#    [Parameter(Mandatory = $true)][string]$BuildID
#)

$NCover_URL = "http://ingbtcpic5ms801:11235/"
$NCover_UN = "admin"
$Ncover_PW = "#welcome123"
$NcoverProject = "CT_PreferenceDS"
$BuildNumber = "CT_PreferenceDS_Nightly_20241008.2"
$SharedPath = "\\ingbtcpic6vwD55\D$"
$resFile = "D:\OutputNcover\$NcoverProject.xml"
$test1 = "export --project $NcoverProject"
$args1 = "--execution=`"$BuildNumber (Consolidated)`" --file=$resFile"

try {
    Write-Host "Connecting to NCover server..."
    ncover connect --server=$NCover_URL --username=$NCover_UN --password=$Ncover_PW
    
    if ($?) {
        Write-Host "Connected to NCover server successfully."
    } else {
        Write-Host "Failed to connect to NCover server."
        exit 1
    }

    # Export the report
    Write-Host "Exporting report..."
    ncover $test1 $args1 --format=v3xml --include-source
    
    # Check if the report file exists
    if (Test-Path -Path $resFile) {
        Write-Host "Report found, copying to shared path..."
        $DestinationPath = Join-Path -Path $SharedPath -ChildPath $NcoverProject.xml
        
        # Copy the report to the shared path
        Copy-Item -Path $resFile -Destination $DestinationPath -Force -ErrorAction SilentlyContinue
        if ($?) {
            Write-Host "Report successfully copied to shared path."
        } else {
            Write-Host "Failed to copy report to shared path."
        }
    } else {
        Write-Host "Report not found at $resFile."
        exit 1
    }
} catch {
    Write-Host "An error occurred: $_"
    exit 1
}

Write-Host "Script completed."
